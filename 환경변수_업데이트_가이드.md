# 🔧 환경 변수 업데이트 가이드

## 🔴 현재 문제

`.env.local` 파일에 **테스트용 로컬 값**이 설정되어 있습니다:

```env
NEXT_PUBLIC_SUPABASE_URL=http://localhost:54321  ← 로컬 주소
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGc...demo...  ← 데모 키
```

이것들은 **로컬 Supabase**용이고, 실제 Supabase 클라우드와는 연결되지 않습니다.

---

## ✅ 해결 방법

Supabase 클라우드 프로젝트의 **실제 API 키**로 업데이트해야 합니다.

---

## 🚀 단계별 가이드

### 1️⃣ Supabase 대시보드에서 API 키 복사

1. **Supabase 대시보드 접속**
   ```
   https://app.supabase.com
   ```

2. **생성한 프로젝트 선택**

3. **Settings 클릭** (왼쪽 하단 톱니바퀴 ⚙️ 아이콘)

4. **API 메뉴 클릭**

5. **다음 3개 값 복사:**

   #### Project URL
   ```
   https://xxxxxxxxxxxxx.supabase.co
   ```
   
   #### anon public (API Keys 섹션)
   ```
   eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3M...
   ```
   
   #### service_role (API Keys 섹션, 아래쪽)
   ```
   eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3M...
   ```
   
   ⚠️ **중요:** `service_role` 키는 절대 공개하지 마세요!

---

### 2️⃣ .env.local 파일 업데이트

**방법 A: PowerShell 명령어 사용 (빠름)**

PowerShell에서 다음 명령어 실행 (실제 값으로 교체):

```powershell
@"
# Supabase 클라우드 설정
NEXT_PUBLIC_SUPABASE_URL=https://xxxxxxxxxxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGc복사한anon키
SUPABASE_SERVICE_ROLE_KEY=eyJhbGc복사한service_role키
"@ | Out-File -FilePath .env.local -Encoding UTF8 -Force
```

**방법 B: 수동 편집**

1. VSCode 또는 메모장으로 `.env.local` 파일 열기

2. 내용을 다음으로 **완전히 교체**:

```env
# Supabase 클라우드 설정
NEXT_PUBLIC_SUPABASE_URL=복사한_Project_URL
NEXT_PUBLIC_SUPABASE_ANON_KEY=복사한_anon_public_키
SUPABASE_SERVICE_ROLE_KEY=복사한_service_role_키
```

3. 저장 (Ctrl+S)

---

### 3️⃣ 서버 재시작 (필수!)

환경 변수 변경 후에는 **반드시 서버를 재시작**해야 합니다!

```bash
# 1. 현재 실행 중인 서버 중지
Ctrl + C

# 2. 서버 재시작
npm run dev
```

---

### 4️⃣ 브라우저 새로고침

```
Ctrl + Shift + R
```

---

## 🧪 테스트

### 1. 홈 페이지 확인

```
http://localhost:3000
```

**기대 결과:**
- ✅ 페이지 정상 로드
- ❌ "Failed to fetch" 에러 없음

### 2. 브라우저 콘솔 확인

```
F12 → Console 탭
```

**기대 결과:**
- ❌ 401, 500 에러 없음
- ✅ 정상 로드

### 3. 회원가입 시도

```
http://localhost:3000/signup
```

1. 이메일: `test@example.com`
2. 비밀번호: `password123!`
3. 비밀번호 확인: `password123!`
4. 회원가입 클릭

**기대 결과:**
- ✅ 온보딩 페이지로 이동
- ✅ 이메일 자동 입력

---

## 📊 올바른 형식 예시

### ✅ 올바른 .env.local

```env
# Supabase 클라우드
NEXT_PUBLIC_SUPABASE_URL=https://abcdefghijk.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFiY2RlZmdoaWprIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDAwMDAwMDAsImV4cCI6MjAxNTU3NjAwMH0.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFiY2RlZmdoaWprIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcwMDAwMDAwMCwiZXhwIjoyMDE1NTc2MDAwfQ.yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy
```

### ❌ 잘못된 형식들

**1. 따옴표 사용 (잘못됨)**
```env
NEXT_PUBLIC_SUPABASE_URL="https://xxx.supabase.co"  ← 따옴표 제거!
```

**2. 공백 포함 (잘못됨)**
```env
NEXT_PUBLIC_SUPABASE_URL = https://xxx.supabase.co  ← 공백 제거!
```

**3. 주석 포함 (잘못됨)**
```env
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co // 내 URL  ← 주석 제거!
```

**4. 로컬 주소 (잘못됨)**
```env
NEXT_PUBLIC_SUPABASE_URL=http://localhost:54321  ← 클라우드 URL로 교체!
```

---

## ⚠️ 주의사항

### 1. 키 구분하기

- **anon public**: 공개 가능, 클라이언트에서 사용
- **service_role**: 비밀 유지 필수, 서버에서만 사용

### 2. 키 확인 방법

**anon public 키:**
- 짧음 (약 200-300자)
- `"role":"anon"` 포함 (JWT 디코딩 시)

**service_role 키:**
- 길음 (약 200-300자)
- `"role":"service_role"` 포함 (JWT 디코딩 시)

### 3. 환경 변수 우선순위

```
.env.local (최우선)
→ .env.development
→ .env
```

`.env.local`을 사용하면 다른 파일의 값을 덮어씁니다.

---

## 🔍 문제 해결

### 문제 1: 여전히 "Failed to fetch"

**확인:**
1. `.env.local` 파일 위치가 프로젝트 루트인지 확인
2. 서버를 재시작했는지 확인
3. 브라우저 캐시 삭제

**해결:**
```bash
# 캐시 삭제
Remove-Item -Recurse -Force .next

# 서버 재시작
npm run dev

# 브라우저 완전 새로고침
Ctrl + Shift + R
```

### 문제 2: "Invalid API key"

**원인:** 키를 잘못 복사했거나 형식이 틀림

**해결:**
1. Supabase 대시보드에서 키 다시 복사
2. 앞뒤 공백 제거
3. 따옴표 없이 붙여넣기
4. 저장 후 서버 재시작

### 문제 3: "relation does not exist"

**원인:** 데이터베이스 테이블이 생성되지 않음

**해결:**
1. Supabase 대시보드 → SQL Editor
2. `supabase/migrations/0002_create_blog_campaign_platform.sql` 내용 복사
3. SQL Editor에 붙여넣기
4. Run 클릭

### 문제 4: 환경 변수가 적용 안 됨

**원인:** 서버 재시작 안 했거나 파일명 오류

**해결:**
1. 파일명 확인: `.env.local` (점으로 시작!)
2. 파일 위치: 프로젝트 루트 (package.json과 같은 폴더)
3. 서버 완전 재시작 (Ctrl+C 후 npm run dev)

---

## 📋 체크리스트

다음을 순서대로 확인하세요:

- [ ] Supabase 대시보드에서 API 키 복사
- [ ] `.env.local` 파일에 실제 키 붙여넣기
- [ ] URL이 `https://xxx.supabase.co` 형식인지 확인
- [ ] 키에 따옴표나 공백 없는지 확인
- [ ] 파일 저장 (Ctrl+S)
- [ ] 서버 완전 재시작 (Ctrl+C → npm run dev)
- [ ] 브라우저 새로고침 (Ctrl+Shift+R)
- [ ] http://localhost:3000 접속
- [ ] "Failed to fetch" 에러 없음 확인
- [ ] 회원가입 테스트 성공

**모두 체크되면 완료!** 🎉

---

## 🆘 여전히 안 되면?

다음 정보를 공유해주세요:

1. **`.env.local` 파일 내용** (service_role 키는 가리고)
2. **브라우저 콘솔 에러** (F12 → Console)
3. **서버 터미널 로그**
4. **Supabase 프로젝트 URL** (Project Settings → API)

빠르게 도와드리겠습니다! 😊

