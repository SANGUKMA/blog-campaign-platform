# 블로그 체험단 플랫폼 - 구현 완료 가이드

## 📋 구현 완료 사항

### ✅ 데이터베이스 스키마
- **위치**: `supabase/migrations/0002_create_blog_campaign_platform.sql`
- **테이블**: 
  - `profiles` - 공통 사용자 프로필 (이름, 생년월일, 휴대폰, 이메일, 역할)
  - `influencer_profiles` - 인플루언서 정보 (채널명, URL, 팔로워 수)
  - `advertiser_profiles` - 광고주 정보 (업체명, 주소, 업장 전화번호, 사업자등록번호, 대표자명)
  - `campaigns` - 체험단 정보
  - `applications` - 체험단 지원 정보
- **보안**: Row Level Security (RLS) 정책 적용

### ✅ 백엔드 API

#### 프로필 API (`/api/profile`)
- `POST /api/profile` - 공통 프로필 생성
- `GET /api/profile` - 프로필 조회
- `POST /api/profile/influencer` - 인플루언서 프로필 생성
- `POST /api/profile/advertiser` - 광고주 프로필 생성

#### 캠페인 API (`/api/campaigns`)
- `GET /api/campaigns` - 모집 중인 캠페인 목록
- `POST /api/campaigns` - 캠페인 생성 (광고주 전용)
- `GET /api/campaigns/my` - 내 캠페인 목록 (광고주 전용)
- `GET /api/campaigns/:id` - 캠페인 상세 조회
- `PATCH /api/campaigns/:id/status` - 캠페인 상태 변경

#### 지원 API (`/api/applications`)
- `POST /api/applications` - 체험단 지원하기
- `GET /api/applications/my` - 내 지원 목록 (인플루언서 전용)
- `GET /api/applications/campaign/:campaignId` - 캠페인 지원자 목록 (광고주 전용)
- `PATCH /api/applications/campaign/:campaignId/bulk` - 일괄 선정/반려

### ✅ 프론트엔드 페이지

#### 공통 페이지
- **홈** (`/`) - 모집 중인 체험단 탐색
- **로그인** (`/login`) - Supabase Auth 이메일 로그인
- **회원가입** (`/signup`) - Supabase Auth 이메일 회원가입
- **온보딩** (`/onboarding`) - 역할 선택 및 정보 등록
  - 1단계: 공통 정보 입력 (이름, 생년월일, 휴대폰, 이메일)
  - 2단계: 역할 선택 (광고주 / 인플루언서)
  - 3단계: 역할별 정보 입력

#### 인플루언서 페이지
- **체험단 상세** (`/campaigns/:id`) - 체험단 정보 확인
- **체험단 지원** (`/campaigns/:id/apply`) - 지원하기
- **내 지원 목록** (`/my-applications`) - 지원 내역 및 상태 확인

#### 광고주 페이지
- **광고주 대시보드** (`/advertiser/dashboard`) - 체험단 목록 및 등록
- **광고주 체험단 상세** (`/advertiser/campaigns/:id`) - 지원자 관리
  - 모집 중: 모집 종료 버튼
  - 모집 종료: 인플루언서 선정 기능

### ✅ 권한 관리
- 인플루언서 정보 등록 완료 시에만 체험단 지원 가능
- 광고주 정보 등록 완료 시에만 광고주 대시보드 접근 가능
- 페이지별 권한 체크 및 리다이렉트

---

## 🚀 실행 방법

### 1. 데이터베이스 마이그레이션

```bash
# Supabase 로컬 개발 환경 시작
supabase start

# 마이그레이션 실행
supabase db reset
```

### 2. 환경 변수 설정

`.env.local` 파일에 Supabase 정보 추가:

```env
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
```

### 3. 개발 서버 실행

```bash
# 의존성 설치
npm install

# 개발 서버 실행
npm run dev
```

---

## 📱 사용자 플로우

### 인플루언서 사용 플로우

1. **회원가입** → `/signup`
   - 이메일/비밀번호로 Supabase Auth 계정 생성
   - 자동으로 온보딩 페이지로 이동
   
2. **온보딩** → `/onboarding`
   - **1단계**: 공통 정보 입력 (이름, 생년월일, 휴대폰, 이메일 자동입력)
   - **2단계**: 역할 선택 (인플루언서 선택)
   - **3단계**: 인플루언서 정보 입력 (채널명, URL, 팔로워 수)
   - 완료 후 자동으로 홈으로 이동
   
3. **홈 페이지** → `/`
   - 모집 중인 체험단 탐색
   - 우측 상단에 "내 지원 목록" 버튼 표시
   
4. **체험단 상세** → `/campaigns/:id`
   - 체험단 정보 확인
   - 인플루언서 프로필이 있어야 "지원하기" 버튼 활성화
   
5. **체험단 지원** → `/campaigns/:id/apply`
   - 각오 한마디, 방문 예정일 입력 후 제출
   
6. **내 지원 목록** → `/my-applications`
   - 신청완료 / 선정 / 반려 상태 확인
   - 상태별 필터링 가능

### 광고주 사용 플로우

1. **회원가입** → `/signup`
   - 이메일/비밀번호로 Supabase Auth 계정 생성
   - 자동으로 온보딩 페이지로 이동
   
2. **온보딩** → `/onboarding`
   - **1단계**: 공통 정보 입력 (이름, 생년월일, 휴대폰, 이메일 자동입력)
   - **2단계**: 역할 선택 (광고주 선택)
   - **3단계**: 광고주 정보 입력 (업체명, 주소, 업장 전화번호, 사업자등록번호, 대표자명)
   - 완료 후 자동으로 광고주 대시보드로 이동
   
3. **광고주 대시보드** → `/advertiser/dashboard`
   - 신규 체험단 등록 (Dialog Form)
   - 내 체험단 목록 확인 (상태별 표시)
   
4. **광고주 체험단 상세** → `/advertiser/campaigns/:id`
   - 지원자 목록 확인 (상세 정보 포함)
   - **모집 중**: 모집 종료 버튼
   - **모집 종료**: 인플루언서 선정 체크박스 + 선정 완료 버튼
   - 선정 완료 시 선정된 인플루언서는 "선정" 상태, 나머지는 "반려" 상태로 자동 처리

### 로그인 플로우 (개선됨)

**최초 로그인 (온보딩 미완료)**
- 로그인 → 프로필 없음 확인 → 자동으로 `/onboarding` 이동

**온보딩 완료 후 로그인**
- **인플루언서**: 로그인 → 프로필 확인 → 홈(`/`) 또는 이전 페이지로 이동
- **광고주**: 로그인 → 프로필 확인 → 광고주 대시보드(`/advertiser/dashboard`)로 이동

**온보딩 중단 후 재로그인**
- 로그인 → 프로필 체크 → 마지막 단계로 자동 이동

---

## 🔑 핵심 기능

### 모집 관리
- **모집 중**: 인플루언서가 지원 가능
- **모집 종료**: 광고주가 수동으로 조기 종료 가능
- **선정 완료**: 광고주가 인플루언서를 선정하면 자동으로 상태 변경

### 지원 관리
- **중복 지원 방지**: 동일 인플루언서가 동일 체험단에 중복 지원 불가
- **상태 관리**: 
  - `pending` (신청완료) - 지원 직후
  - `selected` (선정) - 광고주가 선정
  - `rejected` (반려) - 광고주가 선정하지 않음

### 권한 관리
- 인플루언서 프로필 등록 전에는 지원 불가
- 광고주 프로필 등록 전에는 대시보드 접근 불가
- 각 API는 Supabase Auth 및 프로필 권한 체크

---

## 🔧 기술 스택

- **Frontend**: Next.js 14, React, TypeScript, Tailwind CSS, shadcn/ui
- **Backend**: Hono.js (Next.js API Routes)
- **Database**: PostgreSQL (Supabase)
- **Auth**: Supabase Auth
- **Validation**: Zod

---

## 📝 추가 개발 권장 사항

1. **이메일 알림**
   - 인플루언서 선정 시 이메일 발송
   - 체험단 모집 종료 알림

2. **파일 업로드**
   - 체험단 이미지 업로드
   - 인플루언서 프로필 이미지

3. **검색 및 필터**
   - 체험단 검색 기능
   - 카테고리별 필터링

4. **통계 대시보드**
   - 광고주: 체험단별 지원자 통계
   - 인플루언서: 지원 내역 통계

5. **리뷰 시스템**
   - 체험 완료 후 리뷰 작성
   - 광고주의 인플루언서 평가

---

## 🎯 주요 개선사항 (v2.0)

### 로그인/온보딩 플로우 개선
1. **자동 이메일 입력**: 온보딩 시 Auth 정보에서 이메일 자동 추출
2. **스마트 리다이렉트**: 로그인 시 프로필 상태 확인 후 적절한 페이지로 자동 이동
3. **온보딩 재개**: 온보딩 중단 시 마지막 단계부터 재시작
4. **프로필 상태 체크**: 모든 보호된 페이지에서 권한 자동 확인

### 사용성 개선
1. **홈 페이지 동적 버튼**: 로그인 상태와 역할에 따라 적절한 버튼 표시
2. **권한 기반 접근 제어**: 각 페이지에서 역할별 접근 권한 자동 체크
3. **자동 상태 전환**: 인플루언서 선정 시 나머지 자동 반려 처리

---

## 🧪 테스트 시나리오

### 시나리오 1: 인플루언서 회원가입 → 체험단 지원
1. `/signup` 접속 → 이메일/비밀번호 입력 → 회원가입
2. 자동으로 `/onboarding` 이동
3. 이름, 생년월일, 휴대폰 입력 (이메일 자동입력 확인)
4. "인플루언서" 선택
5. 채널명, URL, 팔로워 수 입력 → 완료
6. 자동으로 홈(`/`)으로 이동
7. 체험단 카드 클릭 → 상세 페이지
8. "지원하기" 버튼 클릭
9. 각오 한마디, 방문 예정일 입력 → 제출
10. "내 지원 목록" 페이지에서 지원 내역 확인

### 시나리오 2: 광고주 회원가입 → 체험단 등록 → 인플루언서 선정
1. `/signup` 접속 → 회원가입
2. 온보딩: 공통 정보 → 광고주 선택 → 광고주 정보 입력
3. 자동으로 `/advertiser/dashboard` 이동
4. "신규 체험단 등록" 버튼 클릭
5. 체험단 정보 입력 (제목, 모집기간, 인원, 혜택, 매장정보, 미션)
6. 등록 완료 → 대시보드에 카드 표시
7. 체험단 카드 클릭 → 상세 페이지
8. 지원자 확인 (인플루언서가 지원한 경우)
9. "모집 종료" 버튼 클릭
10. 원하는 인플루언서 체크박스 선택
11. "선정 완료" 버튼 클릭
12. 선정/반려 상태 자동 처리 확인

### 시나리오 3: 로그인 후 자동 리다이렉트
1. **온보딩 미완료 사용자**: 로그인 → 자동으로 `/onboarding` 이동
2. **인플루언서**: 로그인 → 홈 또는 이전 페이지로 이동
3. **광고주**: 로그인 → `/advertiser/dashboard`로 이동

### 시나리오 4: 권한 체크
1. 인플루언서 계정으로 `/advertiser/dashboard` 접속 시도 → 알림 후 홈으로 리다이렉트
2. 광고주 계정으로 `/my-applications` 접속 시도 → 알림 후 홈으로 리다이렉트
3. 온보딩 미완료 계정으로 체험단 지원 시도 → 온보딩 페이지로 리다이렉트

---

## 🐛 알려진 제한사항

1. 현재는 이메일 인증만 지원 (소셜 로그인 미지원)
2. 파일 업로드 기능 미구현
3. 실시간 알림 미구현
4. 페이지네이션 미구현 (모든 데이터 한번에 로드)
5. 이메일 인증 활성화 시 회원가입 후 온보딩 대신 이메일 인증 필요

---

## 📧 문의

프로젝트 관련 문의사항이 있으시면 이슈를 등록해주세요.

